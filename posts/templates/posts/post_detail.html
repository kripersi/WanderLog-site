{% extends "base.html" %}
{% load static %}

{% block page_title %}{{ post.title }}{% endblock %}

{% block content %}

<div class="post-detail">

    <!-- Верхняя панель -->
    <div class="post-top">
        <h1 class="post-title">{{ post.title }}</h1>

        <div class="post-author">
            {% if post.author.profile.avatar %}
            <img src="{{ post.author.profile.avatar.url }}" class="author-avatar">
            {% endif %}
            <a href="{% url 'users:user_profile' post.author.username %}">
                {{ post.author.username }}
            </a>
        </div>
    </div>

    <!-- Галерея -->
    <div class="gallery">
        <div class="gallery-wrapper">

            <button class="arrow left" onclick="prevImage()" aria-label="Предыдущее фото">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>

            <div class="gallery-slide">
                {% for img in post.images.all %}
                <img src="{{ img.image.url }}" class="gallery-image">
                {% endfor %}
            </div>

            <button class="arrow right" onclick="nextImage()" aria-label="Следующее фото">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>

        </div>
    </div>

    <div class="post-text">
        {{ post.description }}
    </div>
    {% if user.is_authenticated %}
    <div class="like-row">
        <form method="post" action="{% url 'posts:toggle_like' post.pk %}">
            {% csrf_token %}
            {% if is_liked %}
            <button type="submit" class="like-btn liked" aria-label="Убрать лайк" aria-pressed="true">♥</button>
            {% else %}
            <button type="submit" class="like-btn" aria-label="Поставить лайк" aria-pressed="false">♥</button>
            {% endif %}
        </form>
        <span class="like-count">Лайков: {{ post.likes.count }}</span>
    </div>
    {% else %}
    <div class="like-row">
        <span class="like-count">Лайков: {{ post.likes.count }}</span>
    </div>
    {% endif %}
    {% if request.user == post.author %}
    <form method="post" action="{% url 'posts:delete_post' post.pk %}" onsubmit="return confirmDelete();">
        {% csrf_token %}
        <button type="submit" class="delete-btn">Удалить пост</button>
    </form>
    {% endif %}
</div>
<div id="imageModal" class="modal">
    <span class="modal-close" onclick="closeModal()">✕</span>
    <img class="modal-image" id="modalImage">
</div>
<script>
    function confirmDelete() {
        return confirm("Вы уверены, что хотите удалить этот пост?");
    }
</script>
{% block scripts %}
<script src="{% static 'posts/js/post_detail.js' %}"></script>
{% endblock %}

{% endblock %}
